### 什么是web缓存？
web缓存是可以自动保存常见的文档副本的http设备
优点：  
1、减少冗余的数据传输，节省网络费用  
2、缓解网络瓶颈，不需要带宽就可以更快地加载页面  
3、降低了对原始服务器的要求  
4、降低了距离时延  

### 命中和未命中
可以用已有的副本为某些到达缓存的请求提供服务，这是缓存命中。  
其他一些到达缓存的请求没有副本可用，而被转发给服务器，这是缓存未命中。
服务器上的内容可能会发生变化，缓存要时不时的对其进行检测，看看保存的副本是否仍然是服务器上最新的副本，这些新鲜度检测被称为http再验证。通常只有在客户端发起请求时，并且旧副本足以需要检测时，才会对副本进行验证。

再验证时，会向服务器发送一个请求，如果副本没有变化，服务器会以一个304NOT modified进行响应，这些服务器会将这副本提供给客户端，称之为再验证命中或缓慢命中

### 缓存处理步骤

#### 接受

缓存读取从网络到达的请求报文

#### 解析

缓存将请求报文解析为片段，将首部的各部分放入易于操作的数据结构中，这样，缓存软件就更容易处理首部了

#### 查询

缓存获取了url，查找本地副本，本地副本可以存在本地内存、本地磁盘，甚至另一台计算机里。

#### 新鲜度检测

http通过缓存将服务器文档的副本保留了一段时间，这段时间都认为文档是新鲜的，缓存不联系服务器情况下提供该文档，超过新鲜度限值，就认为过期了，提供文档前与服务器再确认

#### 创建响应

缓存的响应已响应的服务器响应首部作为响应首部的起点，然后对这些基础首部进行修改和扩展

#### 发送

一旦响应首部准备好了，缓存就将响应回送给客户端。

#### 日志

大多数的缓存都会保存日志文件以及与缓存相关的统计数据，每个缓存事务结束后，缓存会更新缓存命中和未命中的数据，并将条目插入一个用来显示请求类型、url和所发生事件的日志文件

### 副本新鲜度保持

通过特殊的首部Cache-Control和Expires，http让服务器向文档附加了一个过期日期，过了过期时间就会进行服务器再验证
|首部|描述|
|----|----|
|Cache-Control|max-age定义了文档最大使用期, no-cache（强制要求缓存把请求提交给原始服务器进行验证协商缓存验证），no-store，缓存不应存储有关客户端请求或服务器响应的任何内容，即不使用任何缓存|
|Expires|定义一个绝对过期时间|

#### 条件验证

|首部|描述|
|----|----|
|If-Modifie-Since|date 如果从指定日期之后文档被修改过了，服务器只在所请求的资源在给定的日期时间之后对内容进行过修改的情况下才会将资源返回，状态码为 200，否则返回304，只可以用在 GET 或 HEAD 请求中|
|If-None-Match|优先级强于If-Modifie-Since，有些文档会被周期性重写，修改时间变了但是内容没变，为了解决该问题Etag实体标签进行比较，该项为实体标签的对象，如“v2.0，请求2.0版本是否发生改变”|